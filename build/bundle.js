var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function o(t){t.forEach(e)}function c(t){return"function"==typeof t}function r(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(e,n,o){e.$$.on_destroy.push(function(e,...n){if(null==e)return t;const o=e.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}(n,o))}function u(t,e,n,o){if(t){const c=l(t,e,n,o);return t[0](c)}}function l(t,e,n,o){return t[1]&&o?function(t,e){for(const n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](o(e))):n.ctx}function i(t,e,n,o){if(t[2]&&o){const c=t[2](o(n));if(void 0===e.dirty)return c;if("object"==typeof c){const t=[],n=Math.max(e.dirty.length,c.length);for(let o=0;o<n;o+=1)t[o]=e.dirty[o]|c[o];return t}return e.dirty|c}return e.dirty}function a(t,e,n,o,c,r){if(c){const s=l(e,n,o,r);t.p(s,c)}}function d(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let t=0;t<n;t++)e[t]=-1;return e}return-1}function f(t,e){t.appendChild(e)}function p(t,e,n){t.insertBefore(e,n||null)}function h(t){t.parentNode.removeChild(t)}function m(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function $(t){return document.createElement(t)}function g(t){return document.createTextNode(t)}function v(){return g(" ")}function y(){return g("")}function b(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function _(t){return function(e){return e.preventDefault(),t.call(this,e)}}function k(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function x(t,e,n,o){null===n?t.style.removeProperty(e):t.style.setProperty(e,n,o?"important":"")}function w(t,e,n){t.classList[n?"add":"remove"](e)}let E;function N(t){E=t}function C(){if(!E)throw new Error("Function called outside component initialization");return E}function P(){const t=C();return(e,n)=>{const o=t.$$.callbacks[e];if(o){const c=function(t,e,n=!1){const o=document.createEvent("CustomEvent");return o.initCustomEvent(t,n,!1,e),o}(e,n);o.slice().forEach((e=>{e.call(t,c)}))}}}const I=[],O=[],S=[],M=[],A=Promise.resolve();let D=!1;function W(t){S.push(t)}const T=new Set;let z=0;function j(){const t=E;do{for(;z<I.length;){const t=I[z];z++,N(t),L(t.$$)}for(N(null),I.length=0,z=0;O.length;)O.pop()();for(let t=0;t<S.length;t+=1){const e=S[t];T.has(e)||(T.add(e),e())}S.length=0}while(I.length);for(;M.length;)M.pop()();D=!1,T.clear(),N(t)}function L(t){if(null!==t.fragment){t.update(),o(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(W)}}const R=new Set;let q;function B(){q={r:0,c:[],p:q}}function F(){q.r||o(q.c),q=q.p}function K(t,e){t&&t.i&&(R.delete(t),t.i(e))}function H(t,e,n,o){if(t&&t.o){if(R.has(t))return;R.add(t),q.c.push((()=>{R.delete(t),o&&(n&&t.d(1),o())})),t.o(e)}}function G(t){t&&t.c()}function J(t,n,r,s){const{fragment:u,on_mount:l,on_destroy:i,after_update:a}=t.$$;u&&u.m(n,r),s||W((()=>{const n=l.map(e).filter(c);i?i.push(...n):o(n),t.$$.on_mount=[]})),a.forEach(W)}function Q(t,e){const n=t.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function U(t,e){-1===t.$$.dirty[0]&&(I.push(t),D||(D=!0,A.then(j)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function V(e,c,r,s,u,l,i,a=[-1]){const d=E;N(e);const f=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:u,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(c.context||(d?d.$$.context:[])),callbacks:n(),dirty:a,skip_bound:!1,root:c.target||d.$$.root};i&&i(f.root);let p=!1;if(f.ctx=r?r(e,c.props||{},((t,n,...o)=>{const c=o.length?o[0]:n;return f.ctx&&u(f.ctx[t],f.ctx[t]=c)&&(!f.skip_bound&&f.bound[t]&&f.bound[t](c),p&&U(e,t)),n})):[],f.update(),p=!0,o(f.before_update),f.fragment=!!s&&s(f.ctx),c.target){if(c.hydrate){const t=function(t){return Array.from(t.childNodes)}(c.target);f.fragment&&f.fragment.l(t),t.forEach(h)}else f.fragment&&f.fragment.c();c.intro&&K(e.$$.fragment),J(e,c.target,c.anchor,c.customElement),j()}N(d)}class X{$destroy(){Q(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function Y(e){let n,c,r;return{c(){n=$("div"),x(n,"--width",e[1]-.47*e[1]*!e[5]+"px"),x(n,"transform","translate("+e[4]+"px)"),k(n,"draggable","false"),k(n,"class","svelte-1hi9ixy"),w(n,"accidental",!e[5]),w(n,"natural",e[5]),w(n,"pressed",e[0])},m(t,o){p(t,n,o),c||(r=[b(n,"mousedown",_(e[2])),b(n,"mouseup",_(e[3])),b(n,"mouseenter",e[7]),b(n,"mouseleave",e[8]),b(n,"touchstart",_(e[2])),b(n,"touchend",_(e[3]))],c=!0)},p(t,[e]){2&e&&x(n,"--width",t[1]-.47*t[1]*!t[5]+"px"),16&e&&x(n,"transform","translate("+t[4]+"px)"),1&e&&w(n,"pressed",t[0])},i:t,o:t,d(t){t&&h(n),c=!1,o(r)}}}function Z(t,e,n){let{noteNum:o}=e,{keyWidth:c=56}=e,{pressed:r=!1}=e;const s=P();let u=![1,3,6,8,10].includes(o%12),l=0;function i(t){r||(s("noteon",o),n(0,r=!0))}function a(t){r&&(s("noteoff",o),n(0,r=!1))}u||([1,6].includes(o%12)?l=-c/12:[3,10].includes(o%12)&&(l=c/12));return t.$$set=t=>{"noteNum"in t&&n(6,o=t.noteNum),"keyWidth"in t&&n(1,c=t.keyWidth),"pressed"in t&&n(0,r=t.pressed)},[r,c,i,a,l,u,o,t=>{t.buttons&&i()},t=>{t.buttons&&a()}]}class tt extends X{constructor(t){super(),V(this,t,Z,Y,r,{noteNum:6,keyWidth:1,pressed:0,keyPressed:2,keyReleased:3})}get keyPressed(){return this.$$.ctx[2]}get keyReleased(){return this.$$.ctx[3]}}function et(t,e,n){const o=t.slice();return o[17]=e[n],o}function nt(t,e,n){const o=t.slice();return o[20]=e[n],o[21]=e,o[22]=n,o}function ot(t){let e,n,o=t[20];const c=()=>t[13](e,o),r=()=>t[13](null,o);let s={noteNum:t[20],keyWidth:t[6],pressed:t[0].includes(t[20])};return e=new tt({props:s}),c(),e.$on("noteon",t[14]),e.$on("noteoff",t[15]),{c(){G(e.$$.fragment)},m(t,o){J(e,t,o),n=!0},p(t,n){o!==t[20]&&(r(),o=t[20],c());const s={};8&n&&(s.noteNum=t[20]),64&n&&(s.keyWidth=t[6]),9&n&&(s.pressed=t[0].includes(t[20])),e.$set(s)},i(t){n||(K(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){r(),Q(e,t)}}}function ct(t){let e,n=t[4],o=[];for(let e=0;e<n.length;e+=1)o[e]=rt(et(t,n,e));return{c(){for(let t=0;t<o.length;t+=1)o[t].c();e=y()},m(t,n){for(let e=0;e<o.length;e+=1)o[e].m(t,n);p(t,e,n)},p(t,c){if(16&c){let r;for(n=t[4],r=0;r<n.length;r+=1){const s=et(t,n,r);o[r]?o[r].p(s,c):(o[r]=rt(s),o[r].c(),o[r].m(e.parentNode,e))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},d(t){m(o,t),t&&h(e)}}}function rt(t){let e,n,o=t[17]+"";return{c(){e=$("div"),n=g(o)},m(t,o){p(t,e,o),f(e,n)},p(t,e){16&e&&o!==(o=t[17]+"")&&function(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}(n,o)},d(t){t&&h(e)}}}function st(t){let e,n,o,c,r,s,u;W(t[12]);let l=t[3],i=[];for(let e=0;e<l.length;e+=1)i[e]=ot(nt(t,l,e));const a=t=>H(i[t],1,1,(()=>{i[t]=null}));let d=t[1]&&ct(t);return{c(){e=$("div"),n=$("div");for(let t=0;t<i.length;t+=1)i[t].c();o=v(),d&&d.c(),c=y(),k(n,"class","svelte-e1a7d6"),k(e,"class","keyboard svelte-e1a7d6")},m(l,a){p(l,e,a),f(e,n);for(let t=0;t<i.length;t+=1)i[t].m(n,null);p(l,o,a),d&&d.m(l,a),p(l,c,a),r=!0,s||(u=b(window,"resize",t[12]),s=!0)},p(t,[e]){if(1001&e){let o;for(l=t[3],o=0;o<l.length;o+=1){const c=nt(t,l,o);i[o]?(i[o].p(c,e),K(i[o],1)):(i[o]=ot(c),i[o].c(),K(i[o],1),i[o].m(n,null))}for(B(),o=l.length;o<i.length;o+=1)a(o);F()}t[1]?d?d.p(t,e):(d=ct(t),d.c(),d.m(c.parentNode,c)):d&&(d.d(1),d=null)},i(t){if(!r){for(let t=0;t<l.length;t+=1)K(i[t]);r=!0}},o(t){i=i.filter(Boolean);for(let t=0;t<i.length;t+=1)H(i[t]);r=!1},d(t){t&&h(e),m(i,t),t&&h(o),d&&d.d(t),t&&h(c),s=!1,u()}}}function ut(t,e,n){let o,{octaves:c=2}=e,{middleC:r=60}=e,{keysPressed:s=[]}=e,{verbose:u}=e;const l=12*c;let i,a=[];function d(t,e=0){n(4,a=[`Note ${t} was pressed!`,...a])}function f(t){n(4,a=[`Note ${t} was released!`,...a])}function p(t){var e,n,o;if(u){let e="MIDI message received at timestamp "+t.timeStamp+"["+t.data.length+" bytes]: ";for(let n=0;n<t.data.length;n++)e+="0x"+t.data[n].toString(16)+" ",t.data;console.log(e)}const c=t.data[0],r=t.data[1]%l,s=t.data.length>2?t.data[2]:0;switch(c){case 144:s>0?null===(e=$[r])||void 0===e||e.keyPressed(r):null===(n=$[r])||void 0===n||n.keyReleased(r);break;case 128:null===(o=$[r])||void 0===o||o.keyReleased(r)}}var h;h=async()=>{try{let t=await navigator.requestMIDIAccess();console.log("MIDI ready!"),u&&function(t){for(const e of t.inputs){const t=e[1];console.log("Input port [type:'"+t.type+"'] id:'"+t.id+"' manufacturer:'"+t.manufacturer+"' name:'"+t.name+"' version:'"+t.version+"'")}for(const e of t.outputs){const t=e[1];console.log("Output port [type:'"+t.type+"'] id:'"+t.id+"' manufacturer:'"+t.manufacturer+"' name:'"+t.name+"' version:'"+t.version+"'")}}(t),t.inputs.forEach((t=>{t.onmidimessage=p}))}catch(t){console.log("Failed to get MIDI access - "+t)}},C().$$.on_mount.push(h);let m,$={};return t.$$set=t=>{"octaves"in t&&n(10,c=t.octaves),"middleC"in t&&n(11,r=t.middleC),"keysPressed"in t&&n(0,s=t.keysPressed),"verbose"in t&&n(1,u=t.verbose)},t.$$.update=()=>{3072&t.$$.dirty&&n(3,i=[...Array(12*c+1).keys()].map((t=>t+(r-12*Math.floor(c/2))))),1028&t.$$.dirty&&n(6,o=Math.min((m-36/c)/(8*c),56))},[s,u,m,i,a,$,o,l,d,f,c,r,function(){n(2,m=window.innerWidth)},function(t,e){O[t?"unshift":"push"]((()=>{$[e%l]=t,n(5,$)}))},({detail:t})=>d(t),({detail:t})=>f(t)]}class lt extends X{constructor(t){super(),V(this,t,ut,st,r,{octaves:10,middleC:11,keysPressed:0,verbose:1})}}const it=t=>({}),at=t=>({});function dt(t){let e,n,c,r,s,l,m,g,y;const _=t[4].header,x=u(_,t,t[3],at),w=t[4].default,E=u(w,t,t[3],null);return{c(){e=$("div"),n=v(),c=$("div"),x&&x.c(),r=v(),E&&E.c(),s=v(),l=$("button"),l.textContent="Close",k(e,"class","modal-background svelte-wltfbo"),l.autofocus=!0,k(l,"class","svelte-wltfbo"),k(c,"class","modal svelte-wltfbo"),k(c,"role","dialog"),k(c,"aria-modal","true")},m(o,u){p(o,e,u),p(o,n,u),p(o,c,u),x&&x.m(c,null),f(c,r),E&&E.m(c,null),f(c,s),f(c,l),t[5](c),m=!0,l.focus(),g||(y=[b(window,"keydown",t[2]),b(e,"click",t[1]),b(l,"click",t[1])],g=!0)},p(t,[e]){x&&x.p&&(!m||8&e)&&a(x,_,t,t[3],m?i(_,t[3],e,it):d(t[3]),at),E&&E.p&&(!m||8&e)&&a(E,w,t,t[3],m?i(w,t[3],e,null):d(t[3]),null)},i(t){m||(K(x,t),K(E,t),m=!0)},o(t){H(x,t),H(E,t),m=!1},d(r){r&&h(e),r&&h(n),r&&h(c),x&&x.d(r),E&&E.d(r),t[5](null),g=!1,o(y)}}}function ft(t,e,n){let{$$slots:o={},$$scope:c}=e;const r=P(),s=()=>r("close");let u;const l="undefined"!=typeof document&&document.activeElement;var i;return l&&(i=()=>{l.focus()},C().$$.on_destroy.push(i)),t.$$set=t=>{"$$scope"in t&&n(3,c=t.$$scope)},[u,s,t=>{if("Escape"!==t.key){if("Tab"===t.key){const e=u.querySelectorAll("*"),n=Array.from(e).filter((t=>t.tabIndex>=0));let o=n.indexOf(document.activeElement);-1===o&&t.shiftKey&&(o=0),o+=n.length+(t.shiftKey?-1:1),o%=n.length,n[o].focus(),t.preventDefault()}}else s()},c,o,function(t){O[t?"unshift":"push"]((()=>{u=t,n(0,u)}))}]}class pt extends X{constructor(t){super(),V(this,t,ft,dt,r,{})}}const ht=[];function mt(e,n=t){let o;const c=new Set;function s(t){if(r(e,t)&&(e=t,o)){const t=!ht.length;for(const t of c)t[1](),ht.push(t,e);if(t){for(let t=0;t<ht.length;t+=2)ht[t][0](ht[t+1]);ht.length=0}}}return{set:s,update:function(t){s(t(e))},subscribe:function(r,u=t){const l=[r,u];return c.add(l),1===c.size&&(o=n(s)||t),r(e),()=>{c.delete(l),0===c.size&&(o(),o=null)}}}}const $t=mt(1),gt=mt(!1),vt=t=>({}),yt=t=>({});function bt(t){let e,n;return e=new pt({props:{$$slots:{default:[_t]},$$scope:{ctx:t}}}),e.$on("close",t[10]),{c(){G(e.$$.fragment)},m(t,o){J(e,t,o),n=!0},p(t,n){const o={};2054&n&&(o.$$scope={dirty:n,ctx:t}),e.$set(o)},i(t){n||(K(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){Q(e,t)}}}function _t(e){let n,c,r,s,l,m,y,_,x,w,E,N,C,P,I,O,S,M,A,D,W,T,z;const j=e[3].header,L=u(j,e,e[11],yt),R=L||function(e){let n;return{c(){n=$("h1"),n.textContent="Settings"},m(t,e){p(t,n,e)},p:t,d(t){t&&h(n)}}}();return{c(){R&&R.c(),n=v(),c=$("h2"),c.textContent="Octaves",r=v(),s=$("label"),l=$("input"),m=g("\n          One"),y=v(),_=$("label"),x=$("input"),w=g("\n          Two"),E=v(),N=$("label"),C=$("input"),P=g("\n          Three"),I=v(),O=$("h2"),O.textContent="Debug",S=v(),M=$("label"),A=g("Enable logging:\n          "),D=$("input"),k(l,"type","radio"),k(l,"name","octaves"),l.__value=1,l.value=l.__value,e[6][0].push(l),k(x,"type","radio"),k(x,"name","octaves"),x.__value=2,x.value=x.__value,e[6][0].push(x),k(C,"type","radio"),k(C,"name","octaves"),C.__value=3,C.value=C.__value,e[6][0].push(C),k(D,"type","checkbox")},m(t,o){R&&R.m(t,o),p(t,n,o),p(t,c,o),p(t,r,o),p(t,s,o),f(s,l),l.checked=l.__value===e[1],f(s,m),p(t,y,o),p(t,_,o),f(_,x),x.checked=x.__value===e[1],f(_,w),p(t,E,o),p(t,N,o),f(N,C),C.checked=C.__value===e[1],f(N,P),p(t,I,o),p(t,O,o),p(t,S,o),p(t,M,o),f(M,A),f(M,D),D.checked=e[2],W=!0,T||(z=[b(l,"change",e[5]),b(x,"change",e[7]),b(C,"change",e[8]),b(D,"change",e[9])],T=!0)},p(t,e){L&&L.p&&(!W||2048&e)&&a(L,j,t,t[11],W?i(j,t[11],e,vt):d(t[11]),yt),2&e&&(l.checked=l.__value===t[1]),2&e&&(x.checked=x.__value===t[1]),2&e&&(C.checked=C.__value===t[1]),4&e&&(D.checked=t[2])},i(t){W||(K(R,t),W=!0)},o(t){H(R,t),W=!1},d(t){R&&R.d(t),t&&h(n),t&&h(c),t&&h(r),t&&h(s),e[6][0].splice(e[6][0].indexOf(l),1),t&&h(y),t&&h(_),e[6][0].splice(e[6][0].indexOf(x),1),t&&h(E),t&&h(N),e[6][0].splice(e[6][0].indexOf(C),1),t&&h(I),t&&h(O),t&&h(S),t&&h(M),T=!1,o(z)}}}function kt(t){let e,n,o,c,r,s,u=t[0]&&bt(t);return{c(){e=$("button"),e.textContent="⚙️ Settings",n=v(),u&&u.c(),o=y(),k(e,"display","inline-block;")},m(l,i){p(l,e,i),p(l,n,i),u&&u.m(l,i),p(l,o,i),c=!0,r||(s=b(e,"click",t[4]),r=!0)},p(t,[e]){t[0]?u?(u.p(t,e),1&e&&K(u,1)):(u=bt(t),u.c(),K(u,1),u.m(o.parentNode,o)):u&&(B(),H(u,1,1,(()=>{u=null})),F())},i(t){c||(K(u),c=!0)},o(t){H(u),c=!1},d(t){t&&h(e),t&&h(n),u&&u.d(t),t&&h(o),r=!1,s()}}}function xt(t,e,n){let o,c;s(t,$t,(t=>n(1,o=t))),s(t,gt,(t=>n(2,c=t)));let{$$slots:r={},$$scope:u}=e,l=!1;return t.$$set=t=>{"$$scope"in t&&n(11,u=t.$$scope)},[l,o,c,r,()=>n(0,l=!0),function(){o=this.__value,$t.set(o)},[[]],function(){o=this.__value,$t.set(o)},function(){o=this.__value,$t.set(o)},function(){c=this.checked,gt.set(c)},()=>n(0,l=!1),u]}class wt extends X{constructor(t){super(),V(this,t,xt,kt,r,{})}}function Et(t){let e,n;return e=new lt({props:{octaves:t[0],verbose:t[1]}}),{c(){G(e.$$.fragment)},m(t,o){J(e,t,o),n=!0},p(t,n){const o={};1&n&&(o.octaves=t[0]),2&n&&(o.verbose=t[1]),e.$set(o)},i(t){n||(K(e.$$.fragment,t),n=!0)},o(t){H(e.$$.fragment,t),n=!1},d(t){Q(e,t)}}}function Nt(e){let n,o,c,s,u,l,i,a,d=e[0];u=new wt({});let m=Et(e);return{c(){n=v(),o=$("div"),c=$("h1"),c.innerHTML='<a href="https://github.com/oscarhermoso/svelte-piano">Svelte Piano</a>',s=v(),G(u.$$.fragment),l=v(),m.c(),i=y(),document.title="Svelte Piano",k(o,"class","nav svelte-gz1aa0")},m(t,e){p(t,n,e),p(t,o,e),f(o,c),f(o,s),J(u,o,null),p(t,l,e),m.m(t,e),p(t,i,e),a=!0},p(e,[n]){1&n&&r(d,d=e[0])?(B(),H(m,1,1,t),F(),m=Et(e),m.c(),K(m),m.m(i.parentNode,i)):m.p(e,n)},i(t){a||(K(u.$$.fragment,t),K(m),a=!0)},o(t){H(u.$$.fragment,t),H(m),a=!1},d(t){t&&h(n),t&&h(o),Q(u),t&&h(l),t&&h(i),m.d(t)}}}function Ct(t,e,n){let o,c;return s(t,$t,(t=>n(0,o=t))),s(t,gt,(t=>n(1,c=t))),[o,c]}return new class extends X{constructor(t){super(),V(this,t,Ct,Nt,r,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
